<!DOCTYPE html>

<html>
<?php    
    if (!isset($_SERVER['HTTPS'])) {
        $url = 'https://' . $_SERVER['HTTP_HOST'] .
         $_SERVER['REQUEST_URI'];  // start with /...
        header("Location: " . $url);  // Redirect - 302
        exit;                         // should be before any output
    }                               
?> 
    <head>
        <title>NUTS FOR COOKIEs</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <style>
        </style>
    </head>
    
    <body>
        
        <div class="container">
            <div class="row">
                <div class="bg-success">
                    <!-- <img src="cookie_image.jpg" alt="Cookie picture" style="opacity: 0.6; height: 200px;"> -->
                    <h1 style="text-align:center; padding-top: 10px;">NUTS FOR COOKIES</h1>
                    <h3 style="text-align: center; padding-bottom: 10px;">User: <?php echo $username; ?></h3>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-2 bg-warning">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a id="home" data-toggle="modal" data-target="#">Home</a></li>
                        <li><a id="buy-cookies" data-toggle="modal" data-target="#modal-buy-cookies">Buy Cookies</a></li>
                        <li><a id="sell-cookies" data-toggle="modal" data-target="#modal-sell-cookie">Sell Cookies</a></li>
                        <li><a id="search-cookie" data-toggle="dropdown" class="dropdown-toggle" >Search Cookie<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a id="search-by-name" data-toggle="modal" data-target="#modal-search-name">By name</a></li>
                                <li><a id="search-by-owner" data-toggle="modal" data-target="#modal-search-seller">By seller</a></li>
                                <li><a id="search-by-ID" data-toggle="modal" data-target="#modal-search-ID">By ID</a></li>
                            </ul>
                        </li>
                        <li><a id="marketplace" data-toggle="modal" data-target="#" >Marketplace</a></li>
                        <li><a id="signout">Sign Out</a></li>
                        <li><a id="unsubscribe" data-toggle="modal" data-target="#modal-unsubscribe">Unsubscribe</a></li>
                    </ul>
                </div>
                
                <div class="col-md-10" style="border: black 2px">
                    <div id="content">
                    </div>
                </div>
                <div class="col-md-10">
                    <div id="under-content">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div>
                </div>
            </div>
            
            <div class="modal fade" id="modal-home" role="dialog">
                <div class="modal-dialog">
                </div>
            </div>
            
            <div class="modal fade" id="modal-buy-cookies" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-buy-cookies">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Buy Cookie</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-buy-cookie">Cookie:</label>
                                <input id="input-buy-cookie" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-cookie-request" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Sell Coookie modal window, this will Insert the cookie into the database-->
            <div class="modal fade" id="modal-sell-cookie" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-sell-cookie">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Sell Cookies</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-sell-cookie-name">Cookie Name:</label>
                                <input id="input-sell-cookie-name" class="form-control" type="text" autofocus required>
                                <label for="input-sell-cookie-quantity">Cookie Quantity:</label>
                                <input id="input-sell-cookie-quantity" class="form-control" type="text" autofocus required>
                                <label for="input-sell-cookie-price">Cookie Price:</label>
                                <input id="input-sell-cookie-price" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-sell-cookie" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
             
            <!-- Search cookie by Name modal window -->
            <div class="modal fade" id="modal-search-name" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-search-question">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Search for Cookie by Name</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-search-name">Name:</label>
                                <input id="input-search-name" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-cookie-name" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>    
            </div>     
                    
            <!-- Search cookie by Seller modal window -->
            <div class="modal fade" id="modal-search-seller" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-search-question">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Search for Cookie by Seller</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-search-seller">Seller:</label>
                                <input id="input-search-seller" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-cookie-seller" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>    
            </div>
                    
            <!-- Search cookie by Cookie ID modal window -->
            <div class="modal fade" id="modal-search-ID" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-search-question">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Search for Cookie by ID</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-search-ID">Cookie ID:</label>
                                <input id="input-search-ID" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-cookie-ID" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>    
            </div>
            
            <!-- Update cookie Quantity in Marketplace by Cookie ID modal window -->
            <div class="modal fade" id="modal-update-cookie-quantity" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-update-cookie-quantity">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Update Quantity Cookie by ID</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-update-cookie-quantity-id">Cookie ID:</label>
                                <input id="input-update-cookie-quantity-id" class="form-control" type="text" autofocus required>
                                <label for="input-update-cookie-quantity">New Cookie Quantity:</label>
                                <input id="input-update-cookie-quantity" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-update-cookie-quantity" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>    
            </div>

            <!-- Update cookie Price in Marketplace by Cookie ID modal window -->
            <div class="modal fade" id="modal-update-cookie-price" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-update-cookie-price">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Update Price Cookie by ID</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-update-cookie-price-id">Cookie ID:</label>
                                <input id="input-update-cookie-price-id" class="form-control" type="text" autofocus required>
                                <label for="input-update-cookie-price">New Cookie Price:</label>
                                <input id="input-update-cookie-price" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-update-cookie-price" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>    
            </div>

            <!-- Delete cookie from Marketplace by Cookie ID modal window -->
            <div class="modal fade" id="modal-delete-cookie" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-delete-cookie">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Delete Cookie by ID</h4>
                            </div>
                            <div class="modal-body">
                                <label for="input-delete-cookie-id">Cookie ID:</label>
                                <input id="input-delete-cookie-id" class="form-control" type="text" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-delete-cookie" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>    
            </div>

            <!-- Unsubscribe from the cookie Marketplace, this will delete the user from the Users table -->
            <div class="modal fade" id="modal-unsubscribe" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form-unsubscribe">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Unsubscribe</h4>
                                <h2> Please enter password to confirm that you want to Unsubscribe </h2>
                            </div>
                            <div class="modal-body">
                                <label for="input-unsubscribe">Password:</label>
                                <input id="input-unsubscribe" class="form-control" type="password" autofocus required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="submit-unsubscribe" type="button" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>    
            </div>

            <!-- Home page script -->
            <script>

                $(document).ready (function () {
                    // Function in Marketplace table to run the Show the entire Marketplace table and the elements within
                    $('#home').click(function (){

                        str = "<div class='col-md-5' style='border: black 2px'>"
                        str += "<h3> HELLO THERE </h3>"
                        str += "</div>"
                        str += "<div class='col-md-5' style='border: black 2px'>"
                        str += "<h3> HEY LEFT </h3>"
                        str += "</div>"
                    
                        $('#content').html(str);

                        $('#under-content').css('display', 'block');
                        var url = 'cookie_controller.php';  // controller
                        var query = { page:"MainPage", command: "ShowOwnerTable" };  // read the search term from the input element

                            $.post(url,
                                query,
                                function(data) {
                                    var question = JSON.parse(data);  // Need to display it in a table in <div id='under-content'>
                                    var table = "<table class='table table-striped'>";
                                    table += '<tr>';
                    
                                    for (var p in question[0])
                                        table += '<th>' + p + '</th>';
                                    table += '</tr>';
                        
                                    for (var i = 0; i < question.length; i++) {
                                        table += '<tr>';
                                        for (var p in question[i]) 
                                            table += '<td>' + question[i][p] + '</td>';
                                        table += '</tr>';
                                    }
                        
                                    table += '</table>';
                    
                                    $('#under-content').html(table);
                                });
                        });
                });
                    
                        
                
            </script>
            
            <!-- Buy cookie script -->
            <script>
                
                $("#submit-cookie-request").click(function() 
                {
                    $("#modal-buy-cookies").modal('hide');
                    
                    var url = "cookie_controller.php";
                    var query = { page:"MainPage", command: "#", question: $("#input-buy-cookie").val() };
                    
                    $.post(url,
                          query,
                          function(data) {
                            $("#").html(data);
                    });
                    
                });
                
            </script>
            
             <!-- Sell cookie script -->
            <script>
                 
                $('#submit-sell-cookie').click(function() {
                    $('#under-content').css('display', 'none');
                    $('#modal-sell-cookie').modal('hide');
                
                // Send then'SearchCookieByName' command using jQuery AJAX
                
                    var url = 'cookie_controller.php';  // controller
                    var query = { page:"MainPage", command: "SellCookie",
                                cookie_name: $('input#input-sell-cookie-name').val(),
                                cookie_quantity: $('input#input-sell-cookie-quantity').val(),
                                cookie_price: $('input#input-sell-cookie-price').val() };

                    $.post(url,
                            query,
                            function(data) {
                                $('#content').html(data);

                    });
                });
                
            </script>
            
           <!-- Search Cookie By Name modal script -->
            <script>
            // When the 'Submit' button on the 'Search Cookie by Name' Modal window is // clicked 
            // jquery post
            $('#submit-cookie-name').click(function() {
                $('#under-content').css('display', 'none');
                $('#modal-search-name').modal('hide');
                
                // Send then'SearchCookieByName' command using jQuery AJAX
                
                var url = 'cookie_controller.php';  // controller
                var query = { page:"MainPage", command: "SearchByName",
                                searchTerm: $('input#input-search-name').val() };  // read the search term from the input element

                $.post(url,
                    query,
                    function(data) {
                        var question = JSON.parse(data);  // Need to display it in a table in <div id='content'>
                        var table = "<table class='table table-striped'>";
                        table += '<tr>';
                    
                        for (var p in question[0])
                            table += '<th>' + p + '</th>';
                        table += '</tr>';
                        
                        for (var i = 0; i < question.length; i++) {
                            table += '<tr>';
                            for (var p in question[i]) 
                                table += '<td>' + question[i][p] + '</td>';
                            table += '</tr>';
                        }
                        
                        table += '</table>';
                    
                    $('#content').html(table);
                });
            });
            </script>
            
            <!-- Search Cookie By Seller modal script -->
            <script>
            // When the 'Submit' button on the 'Search Cookie by Name' Modal window is // clicked 
            // jquery post
            $('#submit-cookie-seller').click(function() {
                $('#under-content').css('display', 'none');
                $('#modal-search-seller').modal('hide');
                
                // Send then'SearchCookieByName' command using jQuery AJAX
                
                var url = 'cookie_controller.php';  // controller
                var query = { page:"MainPage", command: "SearchBySeller",
                                searchTerm: $('input#input-search-seller').val() };  // read the search term from the input element

                $.post(url,
                    query,
                    function(data) {
                        var question = JSON.parse(data);  // Need to display it in a table in <div id='content'>
                        var table = "<table class='table table-striped'>";
                        table += '<tr>';
                    
                        for (var p in question[0])
                            table += '<th>' + p + '</th>';
                        table += '</tr>';
                        
                        for (var i = 0; i < question.length; i++) {
                            table += '<tr>';
                            for (var p in question[i]) 
                                table += '<td>' + question[i][p] + '</td>';
                            table += '</tr>';
                        }
                        
                        table += '</table>';
                    
                    $('#content').html(table);
                });
            });
            </script>
            
            <!-- Search Cookie By Cookie ID modal script -->
            <script>
            // When the 'Submit' button on the 'Search Cookie by Name' Modal window is // clicked 
            // jquery post
            $('#submit-cookie-ID').click(function() {
                $('#under-content').css('display', 'none');
                $('#modal-search-ID').modal('hide');
                
                // Send then'SearchCookieByName' command using jQuery AJAX
                
                var url = 'cookie_controller.php';  // controller
                var query = { page:"MainPage", command: "SearchByID",
                                searchTerm: $('input#input-search-ID').val() };  // read the search term from the input element

                $.post(url,
                    query,
                    function(data) {
                        var question = JSON.parse(data);  // Need to display it in a table in <div id='content'>
                        var table = "<table class='table table-striped'>";
                        table += '<tr>';
                    
                        for (var p in question[0])
                            table += '<th>' + p + '</th>';
                        table += '</tr>';
                        
                        for (var i = 0; i < question.length; i++) {
                            table += '<tr>';
                            for (var p in question[i]) 
                                table += '<td>' + question[i][p] + '</td>';
                            table += '</tr>';
                        }
                        
                        table += '</table>';
                    
                    $('#content').html(table);
                });
            });
            </script>
            
            <!-- Marketplace page script -->
            <script>
            
                $("#marketplace").click(function() 
                {
                    navs = "<div style='margin: 10px;'><ul class='nav nav-pills nav-justified'>";
                    navs += "<li><a id='show-table'>Show Table</a></li>";
                    navs += "<li><a id='update-cookie' data-toggle='dropdown' class='dropdown-toggle'>Update Cookie<span class='caret'></span></a>";
                    navs += "<ul class='dropdown-menu'>";
                    navs += "<li><a id='update-quantity' data-toggle='modal' data-target='#modal-update-cookie-quantity'>Update Quantity</a></li>";
                    navs += "<li><a id='update-price' data-toggle='modal' data-target='#modal-update-cookie-price'>Update Price</a></li></ul></li>";
                    navs += "<li><a id='delete-cookie' data-toggle='modal' data-target='#modal-delete-cookie'>Delete Cookie</a></li>";
                    navs += "<li><a id='#'>Get Cookie $ Average</a></li></ul></div>";
                     
                    $('#content').html(navs);
                    
                    $(document).ready (function () {
                        // Function in Marketplace table to run the Show the entire Marketplace table and the elements within
                        $('#show-table').click(function (){
                            $('#under-content').css('display', 'block');
                            var url = 'cookie_controller.php';  // controller
                            var query = { page:"MainPage", command: "ShowMarketplace" };  // read the search term from the input element

                            $.post(url,
                                query,
                                function(data) {
                                    var question = JSON.parse(data);  // Need to display it in a table in <div id='content'>
                                    var table = "<table class='table table-striped'>";
                                    table += '<tr>';
                    
                                    for (var p in question[0])
                                        table += '<th>' + p + '</th>';
                                    table += '</tr>';
                        
                                    for (var i = 0; i < question.length; i++) {
                                        table += '<tr>';
                                        for (var p in question[i]) 
                                            table += '<td>' + question[i][p] + '</td>';
                                        table += '</tr>';
                                    }
                        
                                    table += '</table>';
                    
                                    $('#under-content').html(table);
                                });
                        });
                    
                    // Function in Marketplace table to run the Update table when a cookie needs to be updated in quantity.
                        $('#submit-update-cookie-quantity').click(function() {
                            $('#modal-update-cookie-quantity').modal('hide');

                            var url = 'cookie_controller.php';
                            var query = { page:"MainPage", command: "UpdateCookieQuantity", 
                                        searchTerm: $("input#input-update-cookie-quantity-id").val(),
                                        cookie_quantity: $("input#input-update-cookie-quantity").val() };

                            $.post(url,
                                query,
                                function(data) {
                                $('#under-content').html(data);
                            });
                        });

                    // Function in Marketplace table to run the Update table when a cookie needs to be updated in price.
                        $('#submit-update-cookie-price').click(function() {
                            $('#modal-update-cookie-price').modal('hide');

                            var url = 'cookie_controller.php';
                            var query = { page:"MainPage", command: "UpdateCookiePrice", 
                                        searchTerm: $("input#input-update-cookie-price-id").val(),
                                        cookie_price: $("input#input-update-cookie-price").val() };

                            $.post(url,
                                query,
                                function(data) {
                                $('#under-content').html(data);
                            });
                        });

                        // Function in Marketplace table to run the Delete button located in the Marketplace page
                        $('#submit-delete-cookie').click(function() {
                            $('#modal-delete-cookie').modal('hide');

                            var url = 'cookie_controller.php';
                            var query = { page:"MainPage", command: "DeleteCookie", cookie_delete: $("input#input-delete-cookie-id").val() };

                            $.post(url,
                                query,
                                function(data) {
                                $('#under-content').html(data);
                            });
                        });
                    });
                });       
                
            </script>
            
            <form id="form-signout" method ="post" action="cookie_controller.php" style="display: none">
                <input type="hidden" name="page" value="MainPage">
                <input type="hidden" name="command" value="SignOut">
            </form>
            
            
            <script>
                function signout() {
                    document.getElementById('form-signout').submit();  // submit the 'form-signout' form.
                }

                // When the 'sign-out' navigation pill is clicked
                $('#signout').click(function () {
                       var url = 'cookie_controller.php';
                       var query = { page:"MainPage", command: "SignOut" }; 
                });
            </script>
            
            <!-- Function to unsubscribe from the page, this will Delete the user from the Users database.-->
            <script>
                 
                $('#submit-unsubscribe').click(function() {
                    $('#under-content').css('display', 'none');
                    $('#modal-unsubscribe').modal('hide');
                
                // Send then'SearchCookieByName' command using jQuery AJAX
                
                    var url = 'cookie_controller.php';  // controller
                    var query = { page:"MainPage", command: "Unsubscribe",
                                user_password: $('input#input-unsubscribe').val() };

                    $.post(url,
                            query,
                            function(data) {
                                $('#under-content').html(data);
                            });

                    });
                });
                
            </script>
            
        </div>
    </body>
</html>